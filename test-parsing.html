<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç –†–ï–ê–õ–¨–ù–û–ì–û –ø–∞—Ä—Å–∏–Ω–≥–∞ Wildberries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            max-width: 1200px;
            padding: 30px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #007bff;
        }
        .result-box {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error-box {
            background: #f8d7da;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            color: #721c24;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner-border {
            color: #007bff;
        }
        .btn-test {
            background: linear-gradient(45deg, #007bff, #0056b3);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        .real-data-badge {
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .mock-data-badge {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="test-container">
            <div class="text-center mb-4">
                <h1 class="display-4">üß™ –¢–µ—Å—Ç –†–ï–ê–õ–¨–ù–û–ì–û –ø–∞—Ä—Å–∏–Ω–≥–∞ Wildberries</h1>
                <p class="lead">–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞—à —Å–∞–π—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å WB, –∞ –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–µ—Ç –∏—Ö!</p>
            </div>

            <!-- –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID -->
            <div class="test-section">
                <h3>üîç –¢–µ—Å—Ç 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID</h3>
                <p>–ü—Ä–æ–≤–µ—Ä–∏–º —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä —Å Wildberries: <strong>310517806</strong> (–æ—á–∫–∏ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ)</p>
                <div class="row">
                    <div class="col-md-6">
                        <input type="number" id="productId" class="form-control" value="310517806" placeholder="ID —Ç–æ–≤–∞—Ä–∞">
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-test w-100" onclick="testProductById()">
                            üöÄ –ü–æ–ª—É—á–∏—Ç—å –†–ï–ê–õ–¨–ù–´–ï –¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞
                        </button>
                    </div>
                </div>
                <div class="loading" id="loading1">
                    <div class="spinner-border" role="status"></div>
                    <p>–ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ —Å Wildberries...</p>
                </div>
                <div id="result1"></div>
            </div>

            <!-- –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div class="test-section">
                <h3>üîé –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤</h3>
                <p>–ü–æ–∏—â–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É –∏ –ø—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ</p>
                <div class="row">
                    <div class="col-md-6">
                        <input type="text" id="searchQuery" class="form-control" value="–æ—á–∫–∏ —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–µ" placeholder="–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å">
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-test w-100" onclick="testSearch()">
                            üîç –ù–∞–π—Ç–∏ –†–ï–ê–õ–¨–ù–´–ï —Ç–æ–≤–∞—Ä—ã
                        </button>
                    </div>
                </div>
                <div class="loading" id="loading2">
                    <div class="spinner-border" role="status"></div>
                    <p>–ò—â–µ–º —Ç–æ–≤–∞—Ä—ã –Ω–∞ Wildberries...</p>
                </div>
                <div id="result2"></div>
            </div>

            <!-- –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ -->
            <div class="test-section">
                <h3>üè™ –¢–µ—Å—Ç 3: –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤</h3>
                <p>–ù–∞–π–¥–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞</p>
                <div class="row">
                    <div class="col-md-6">
                        <input type="text" id="competitorQuery" class="form-control" value="–Ω–∞—É—à–Ω–∏–∫–∏" placeholder="–ó–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤">
                    </div>
                    <div class="col-md-6">
                        <button class="btn btn-test w-100" onclick="testCompetitors()">
                            üéØ –ù–∞–π—Ç–∏ –†–ï–ê–õ–¨–ù–´–• –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
                        </button>
                    </div>
                </div>
                <div class="loading" id="loading3">
                    <div class="spinner-border" role="status"></div>
                    <p>–ò—â–µ–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –Ω–∞ Wildberries...</p>
                </div>
                <div id="result3"></div>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã –æ—Ç –±–∞–Ω–∞ -->
            <div class="test-section">
                <h3>üõ°Ô∏è –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã –æ—Ç –±–∞–Ω–∞</h3>
                <p>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ Wildberries</p>
                <button class="btn btn-test w-100" onclick="checkAntibanStatus()">
                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã
                </button>
                <div class="loading" id="loading4">
                    <div class="spinner-border" role="status"></div>
                    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞—â–∏—Ç—É –æ—Ç –±–∞–Ω–∞...</p>
                </div>
                <div id="result4"></div>
            </div>

            <div class="alert alert-info mt-4">
                <h5>üìã –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ:</h5>
                <ul>
                    <li>‚úÖ –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –ø–æ–ª–µ <code>source: 'REAL_WB_SERVER_API'</code> –∏–ª–∏ <code>source: 'REAL_WB_SERVER_SEARCH'</code></li>
                    <li>‚úÖ –¶–µ–Ω—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Ä—É–±–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 131800 –∫–æ–ø–µ–µ–∫ = 1318 —Ä—É–±–ª–µ–π)</li>
                    <li>‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É –Ω–∞ —Å–∞–π—Ç–µ Wildberries</li>
                    <li>‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç –±–∞–Ω–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ —Ä–æ—Ç–∞—Ü–∏–µ–π User-Agent</li>
                    <li>‚ùå –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ - –∑–Ω–∞—á–∏—Ç –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        async function testProductById() {
            const productId = document.getElementById('productId').value;
            const loading = document.getElementById('loading1');
            const result = document.getElementById('result1');

            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ ID —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä:', productId);
                const response = await fetch(`/api/wb/product/${productId}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const product = await response.json();
                loading.style.display = 'none';

                const isReal = product.source === 'REAL_WB_SERVER_API';
                const badge = isReal ?
                    '<span class="real-data-badge">‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –° –°–ï–†–í–ï–†–ê</span>' :
                    '<span class="mock-data-badge">‚ùå –ú–û–ö–û–í–´–ï –î–ê–ù–ù–´–ï</span>';

                result.innerHTML = `
                    <div class="result-box">
                        ${badge}
                        <h5>–¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω:</h5>
                        ${JSON.stringify(product, null, 2)}
                    </div>
                `;
            } catch (error) {
                loading.style.display = 'none';
                result.innerHTML = `
                    <div class="error-box">
                        <h5>‚ùå –û—à–∏–±–∫–∞:</h5>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function testSearch() {
            const query = document.getElementById('searchQuery').value;
            const loading = document.getElementById('loading2');
            const result = document.getElementById('result2');

            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä:', query);
                const response = await fetch(`/api/wb/search?q=${encodeURIComponent(query)}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const products = await response.json();
                loading.style.display = 'none';

                const isReal = products.length > 0 && products[0].source === 'REAL_WB_SERVER_SEARCH';
                const badge = isReal ?
                    '<span class="real-data-badge">‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –° –°–ï–†–í–ï–†–ê</span>' :
                    '<span class="mock-data-badge">‚ùå –ú–û–ö–û–í–´–ï –î–ê–ù–ù–´–ï</span>';

                result.innerHTML = `
                    <div class="result-box">
                        ${badge}
                        <h5>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${products.length}</h5>
                        ${JSON.stringify(products.slice(0, 3), null, 2)}
                    </div>
                `;
            } catch (error) {
                loading.style.display = 'none';
                result.innerHTML = `
                    <div class="error-box">
                        <h5>‚ùå –û—à–∏–±–∫–∞:</h5>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function testCompetitors() {
            const query = document.getElementById('competitorQuery').value;
            const loading = document.getElementById('loading3');
            const result = document.getElementById('result3');

            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä:', query);
                const response = await fetch(`/api/wb/search?q=${encodeURIComponent(query)}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const competitors = await response.json();
                loading.style.display = 'none';

                const isReal = competitors.length > 0 && competitors[0].source === 'REAL_WB_SERVER_SEARCH';
                const badge = isReal ?
                    '<span class="real-data-badge">‚úÖ –†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –° –°–ï–†–í–ï–†–ê</span>' :
                    '<span class="mock-data-badge">‚ùå –ú–û–ö–û–í–´–ï –î–ê–ù–ù–´–ï</span>';

                result.innerHTML = `
                    <div class="result-box">
                        ${badge}
                        <h5>–ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤: ${competitors.length}</h5>
                        ${JSON.stringify(competitors.slice(0, 3), null, 2)}
                    </div>
                `;
            } catch (error) {
                loading.style.display = 'none';
                result.innerHTML = `
                    <div class="error-box">
                        <h5>‚ùå –û—à–∏–±–∫–∞:</h5>
                        ${error.message}
                    </div>
                `;
            }
        }

        async function checkAntibanStatus() {
            const loading = document.getElementById('loading4');
            const result = document.getElementById('result4');

            loading.style.display = 'block';
            result.innerHTML = '';

            try {
                console.log('üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã –æ—Ç –±–∞–Ω–∞...');
                const response = await fetch('/api/wb/antiban-status');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const status = await response.json();
                loading.style.display = 'none';

                const statusColor = status.remainingRequests > 10 ? 'success' : 'warning';

                result.innerHTML = `
                    <div class="result-box">
                        <span class="real-data-badge">üõ°Ô∏è –ó–ê–©–ò–¢–ê –ê–ö–¢–ò–í–ù–ê</span>
                        <h5>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã:</h5>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <strong>üìä –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤:</strong><br>
                            ‚Ä¢ –ó–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –º–∏–Ω—É—Ç—É: ${status.requestsLastMinute}/${status.maxRequestsPerMinute}<br>
                            ‚Ä¢ –û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: ${status.remainingRequests}<br>
                            ‚Ä¢ –í—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: ${Math.round(status.timeSinceLastRequest / 1000)}—Å<br><br>

                            <strong>üîí –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—â–∏—Ç—ã:</strong><br>
                            ‚Ä¢ ${status.protection.rateLimit}<br>
                            ‚Ä¢ ${status.protection.delays}<br>
                            ‚Ä¢ User-Agent —Ä–æ—Ç–∞—Ü–∏—è: ${status.protection.userAgentRotation}<br>
                            ‚Ä¢ –î–µ—Ç–µ–∫—Ü–∏—è –±–∞–Ω–∞: ${status.protection.banDetection}<br>
                            ‚Ä¢ –ü–æ–¥–º–µ–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: ${status.protection.headerSpoofing}<br><br>

                            <strong>üåê –¢–µ–∫—É—â–∏–π User-Agent:</strong><br>
                            <code style="font-size: 12px;">${status.currentUserAgent}</code>
                        </div>
                    </div>
                `;
            } catch (error) {
                loading.style.display = 'none';
                result.innerHTML = `
                    <div class="error-box">
                        <h5>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞—â–∏—Ç—ã:</h5>
                        ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
